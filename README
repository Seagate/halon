== BUILDING ==

Prequisites:

 * ghc-7.6.1 -- http://www.haskell.org/ghc

 * cabal-install -- http://www.haskell.org/cabal/download.html

 * mero

 * initialization of submodules -- `git submodule update --init --recursive`

 * Any other dependencies listed in subfolders.

Environment variables:

  MERO_ROOT Must point to the root of the mero source and build tree.

  GENDERS   Must point to a genders file describing the current host and perhaps
            others. See mero-ha/scripts/genders-parsci for an example. The file
            can also be generated by running:

              $ mero-ha/scripts/mkgenders > genders-`hostname -s`

Initial setup:

For the build process to go smoothly, dependencies of packages must be installed.
Because specific versions of the dependencies are necessary, the constraints of
all packages must be considered. The following script should get Haskell
dependencies installed:

 $ export PATH=~/.cabal/bin:$PATH
 $ git submodule update --init --recursive
 $ make dep

Building and testing with the TCP transport:

 $ make ci

Building and testing with the RPC transport:

 $ make USE_RPC=true ci

Just building:

 $ make [ USE_RPC=true ] install

Building the rpm package:

 $ make rpm

=== The build process ===

The HA implementation is composed of several packages. Each package is provided
in a separate folder. Each folder contains a Makefile which is invoked from the
top-level Makefile.

Haskell packages are built and then installed in the user package database,
maintained by Cabal, a tool for building and installing Haskell programs and
libraries.

Randomized tests require building some packages twice. When building for regular
use, the built packages are installed in the `.cabal-sandbox` sandbox. When
building for randomized tests, the package is installed in a package database
created by the top-level Makefile in `.cabal-sandbox-scheduler`.
